## 正则表达式


>### 作用
* ```分割```、```查找```、```匹配```、```替换```

>### 分隔符
* 正斜线 ```/```
* hash 符号 ```#```
* 取反符号 ```~```

>### 通用原子
* ```\d``` : ```1-9```
* ```\D``` : 除了 ```1-9``` 之外的字符
* ```\w``` : 数字、字母、下划线
* ```\W``` : 除了数字、字母、下划线之外的字符
* ```\s``` : 空白符
* ```\S``` : 除了空白符之外的字符

>### 元字符
* ```.``` : 除了换行符之外的任意
* ```*``` : 匹配前面的内容，出现 ```0``` 次、```1``` 次或多次
* ```?``` : ```0``` 次或 ```1``` 次
* ```^``` : 必须以他开头
* ```$``` : 必须以他结尾
* ```+``` : ```1``` 次或多次
* ```{n}``` : 恰好 ```n``` 次
* ```{n,}``` : 大于等于 ```n``` 次
* ```{n,m}``` : 大于等于 ```n```，小于等于 ```m```
* ```[]``` : 集合。如 ```[abc]``` 代表 ```a``` 或 ```b``` 或 ```c```
* ```()``` : 后向引用一个整体
* ```[^]``` : 取反。如 ```[abc]``` 表示除 ```a``` 或除 ```b``` 或除 ```c```
* ```|``` : 或者
* ```[-]``` : 范围。如 ```[0-9]``` 表示 ```0123456789```

>### 模式修正符
* ```i``` : 不区分大小写
* ```m``` : 将字符串通过分隔符进行分割，将字符串的每一行分别进行匹配，前提是字符串中要有换行
* ```e``` : 对匹出来的内容进行处理，```PHP 7.0``` 去除之
* ```s``` : 修正 . 的换行
* ```U``` : 取消贪婪模式
* ```x``` : 忽略模式中的空白符
* ```A``` : 必须以这个模式开头
* ```D``` : 修正 ```$``` 对 ```\n``` 的忽略
* ```u``` : ```uft-8``` 中文匹配

>### 后向引用
*   ```php
    <?php
    $str = 'foo_bar+baz';
    $pattern = '/foo(.*)baz/';
    echo preg_replace($pattern, '\\1', $str);
    ```

>### 贪婪模式
*   ```php
    <?php
    $str = 'foo_bar+baz';
    $pattern = '/foo(.*)baz/';
    echo preg_replace($pattern, '\\1', $str);
    echo PHP_EOL; // 换行
    $pattern = '/foo(.*?)baz/';
    echo preg_replace($pattern, '\\1', $str); // 模式修正符 U 不能与 ? 同时出现，否则贪婪
    ```

>### 正则表达式 PCRE 函数
* ```preg_match()``` : 匹配正则表达式
* ```preg_match_all()``` : 执行一个全局的正则匹配
* ```preg_replace()``` : 执行一个正则匹配并替换
* ```preg_split()``` : 通过一个正则表达式分隔字符串

>### 中文匹配
* ```UTF-8``` 汉字编码范围是 ```0x4e00``` - ```0x9fe5```
* ```ANSI(gb2132)``` 环境下，```0xb0``` - ```0xf7```，```0xa1``` - ```0xfe```
* ```UTF-8``` 要使用 ```u``` 模式修正符使字符串被当做 UTF-8
* 在 ```ANSI(gb2132)``` 环境下，使用 ```chr()``` 将 ```ASCII``` 编码转换为字符
*   ```php
    <?php
    $str = '中文';
    $pattern = '/[\x{4e00}-\x{9fa5}]+/u';
    preg_match($pattern, $str, $match);
    var_dump($match);
    
    // gb2132
    $pattern = '/[' . chr(0xb0) . '-' . chr(0xf7) . '][' . chr(0xa1) . '-' . chr(0xfe) . ']/';    
    ```

>### 解题方法
* 先写出一个要匹配的字符串
* 自左向右的顺序使用正则表达式的原子和元字符进行拼接
* 最终加入模式修正符

>### 真题
* 请写出以 ```139``` 开头的 ```11``` 位手机号的正则表达式
    ```php
    <?php
    $str = '13900000000';
    $pattern = '/^139\d{8}$/';
    preg_match($pattern, $str, $match);
    var_dump($match);
    ```
* 请写出一个正则表达式，取出页面中所有的 img 标签中的 src 值
    ```php
    <?php
    $str = '<img alt="高清无码" id="av" src="av.jpg" />';
    $pattern = '<img.*?src="(.*?)".*?\/?>i'; // 后向引用，可以将其打印出来
    preg_match($pattern, $str, $match);
    var_dump($match);
    
    // 如有多个标签，请用 preg_match_all() 打印全部
    // 可以在末尾加 U 来代替 ? 取消贪婪模式
    ```
